<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=yes, initial-scale=1.5, maximum-scale=1.5, minimum-scale=1.5, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>App</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="css/base.css" />
        <script>
            function _GET(param) {
                var url = window.location.search.replace("?", "");
                var itens = url.split("&");
                for (n in itens)
                {
                    if (itens[n].match(param))
                    {
                        return decodeURIComponent(itens[n].replace(param + "=", ""));
                    }
                }
                return null;
            }
        </script>
    </head>
    <body>

        <div id="menu">
            <ul>
                <li><a href="categorias.html"><span class="glyphicon glyphicon-th-large"></span> Cardápio</a></li>
                <li><a href="update-login.html"><span class="glyphicon glyphicon-repeat"></span> Atualizar</a></li>
                <li><a href="config-login.html"><span class="glyphicon glyphicon-cog"></span> Configurar</a></li>
                <li><a href="#" onclick="exit()"><span class="glyphicon glyphicon-off"></span> Fechar</a></li>
            </ul>
        </div>

        <div class="clearfix" style="padding: 10px 20px; border-bottom: 1px solid #eee">
            <script>
                var vCategoriaId = _GET('categoria');
                document.write('<a href="produtos.html?categoria=' + vCategoriaId + '" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></a>');
            </script>
            <button class="btn btn-default pull-right closed" id="show-hide-menu"><span class="glyphicon glyphicon-align-justify"></span></button>
        </div>

        <div style="padding: 10px 20px; border-bottom: 1px solid #eee;">
            <button class="btn btn-danger btn-block" onclick="callWaiter()"><span class="glyphicon glyphicon-bell"></span> Chamar Garçon</button>
        </div>

        <div class="main">
            <div id="output" class="clearfix"></div>
        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/base.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>

        <script type="text/javascript" src="js/database.js"></script>
        <script type="text/javascript" src="js/functions.js"></script>
        <script type="text/javascript">

                $('#output').css('height', vWindowHeight - 110);

                document.addEventListener("deviceready", onDeviceReady, false);
                function onDeviceReady() {

                    db.transaction(getRecords, errorCallBack, successCallBack);
                }

                function getRecords(tx) {
                    var vId = _GET('id');
                    tx.executeSql("SELECT * FROM Produto WHERE Id = ?", [vId], showRecords, errorCallBack);
                }

                function showRecords(tx, result) {
                    var output = document.getElementById("output");
                    var list = '';
                    if (result.rows.length > 0) {
                        list = list + '<div class="debug" style="margin-bottom: 20px"><button class="btn btn-default btn-block" onclick="deleteProdutoRecords()"><span class="glyphicon glyphicon-trash"></span> Limpar registros</button></div>';
                        for (var i = 0; i < result.rows.length; i++) {
                            var row = result.rows.item(i);
                            list = list + '<div class="thumbnail text-center" style="padding: 20px;">';
                            list = list + '<div>';
                            list = list + '<img style="max-width: 100%;" src="' + row.Imagem + '">';
                            list = list + '</div>';
                            list = list + '<div class="x-pedido">';

                            /**/list = list + '<div style="margin-bottom: 20px;">';
                            /****/list = list + '<strong>' + row.Descricao + '</strong>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="text-align: center; margin-bottom: 20px">';
                            /****/list = list + 'Valor unitário<br>R$ ';
                            /****/list = list + '<span id="valor-unitario">';
                            /******/list = list + row.Preco;
                            /****/list = list + '</span>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="overflow: auto">';
                            /****/list = list + '<div style="width: 33%; float: left">';
                            /******/list = list + '<button id="menos" type="button" class="btn btn-default btn-block" onclick="quantidadeDown()" style="border-top-right-radius: 0; border-bottom-right-radius: 0" disabled="disabled"><span class="glyphicon glyphicon-minus"></span></button>';
                            /****/list = list + '</div>';
                            /****/list = list + '<div style="text-align: center; width: 34%; float: left; margin-left: -1px; margin-right: -1px;">';
                            /******/list = list + '<input id="quantidade" type="text" class="form-control" style="text-align: center; border-radius: 0;" value="1">';
                            /****/list = list + '</div>';
                            /****/list = list + '<div style="width: 33%; float: left">';
                            /******/list = list + '<button id="mais" type="button" class="btn btn-default btn-block" onclick="quantidadeUp()" style="border-top-left-radius: 0; border-bottom-left-radius: 0"><span class="glyphicon glyphicon-plus"></span></button>';
                            /****/list = list + '</div>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="margin-top: 20px;">';
                            /****/list = list + 'Total<br>';
                            /****/list = list + '<div class="text-success">R$ ';
                            /******/list = list + '<span id="total">';
                            /********/list = list + row.Preco;
                            /******/list = list + '</span>';
                            /**/list = list + '</div>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="margin-top: 20px;">';
                            /****/list = list + '<textarea class="form-control" rows="2" placeholder="Observações..."></textarea>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="margin-top: 20px;">';
                            /****/list = list + '<a href="carrinho.html" class="btn btn-success btn-block"><span class="glyphicon glyphicon-plus"></span> Adicionar</a>';
                            /**/list = list + '</div>';

                            /**/list = list + '<div style="margin-top: 20px;">';
                            /****/list = list + '<a href="#" class="btn btn-danger btn-block"><span class="glyphicon glyphicon-ban-circle"></span> Cancelar</a>';
                            /**/list = list + '</div>';

                            list = list + '</div>';
                            // ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                            list = list + '<div class="debug" style="margin-top: 20px"><a href="produto-edicao.html?id=' + row.Id + '" class="btn btn-default btn-block"><span class="glyphicon glyphicon-pencil"></span></a></div>';
                            // ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                            list = list + '<div class="debug">';
                            list = list + '<div id="confirmModal' + row.Id + '" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirmModal" aria-hidden="true" style="display: none;">';
                            list = list + '<div class="modal-dialog">';
                            list = list + '<div class="modal-content">';
                            list = list + '<div class="modal-header">';
                            list = list + '<h4 class="modal-title" id="confirmModal' + row.Id + '">Atenção!</h4>';
                            list = list + '</div>';
                            list = list + '<div class="modal-body">';
                            list = list + 'Tem certeza da exclusão do registro?';
                            list = list + '</div>';
                            list = list + '<div class="modal-footer" style="text-align:center">';
                            list = list + '<button class="btn btn-danger" onclick="del(' + row.Id + ')">Sim</button>';
                            list = list + '<button type="button" class="btn btn-default" data-dismiss="modal">Não</button>';
                            list = list + '</div>';
                            list = list + '</div>';
                            list = list + '</div>';
                            list = list + '</div>';
                            list = list + '</div>';
                            list = list + '<div class="debug" style="margin-top: 20px"><button class="btn btn-default btn-block" data-toggle="modal" data-target="#confirmModal' + row.Id + '"><span class="glyphicon glyphicon-remove"></span></button></div>';
                            // ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                            list = list + '</div>';
                        }
                    } else {
                        // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                        list = list + '<div class="debug" style="margin-bottom: 20px"><a href="produto-cadastro.html" class="btn btn-default btn-block"><span class="glyphicon glyphicon-plus"></span> Cadastrar</a></div>';
                        // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                        list = list + '<div class="alert alert-warning" style="margin-top: 20px; margin-bottom: 0; padding: 5px 10px;">Nenhum registro encontrado.</div>';
                    }
                    output.innerHTML = list;
                }

                function quantidadeUp() {
                    var vValorUnitario = parseFloat($('#valor-unitario').text());
                    var vQuantidade = parseInt($('#quantidade').val());
                    vQuantidade += 1;
                    $('#quantidade').val(vQuantidade);
                    $('#menos').removeAttr('disabled');
                    $('#total').html((vQuantidade * vValorUnitario).toFixed(2));
                }

                function quantidadeDown() {
                    var vValorUnitario = parseFloat($('#valor-unitario').text());
                    if ($('#quantidade').val() > 1) {
                        var vQuantidade = parseInt($('#quantidade').val());
                        vQuantidade -= 1;
                        $('#quantidade').val(vQuantidade);
                        $('#total').html((vQuantidade * vValorUnitario).toFixed(2));
                        if ($('#quantidade').val() == 1) {
                            $('#menos').attr('disabled', 'disabled');
                        }
                    }
                }

                function del(id) {
                    db.transaction(function(transaction) {
                        transaction.executeSql("DELETE FROM Produto WHERE Id = ?", [id], nullCallBack, errorCallBack);
                    }, errorCallBack, pageReload);
                }

                function deleteProdutoRecords() {
                    db.transaction(function(transaction) {
                        transaction.executeSql('DELETE FROM Produto', [], nullCallBack, errorCallBack);
                    }, errorCallBack, pageReload);
                }

                function pageReload() {
                    location.href = 'produtos.html';
                }

        </script>

    </body>
</html>
