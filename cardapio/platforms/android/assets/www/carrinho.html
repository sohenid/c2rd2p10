<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=yes, initial-scale=1.5, maximum-scale=1.5, minimum-scale=1.5, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>App</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="css/base.css" />
    </head>
    <body>

        <script src="js/ui-menu.js"></script>

        <div class="clearfix" style="padding: 10px 20px; border-bottom: 1px solid #eee">
            <button class="btn btn-default pull-right closed" id="show-hide-menu"><span class="glyphicon glyphicon-align-justify"></span></button>
        </div>

        <div style="padding: 10px 20px; border-bottom: 1px solid #eee">
            <button class="btn btn-danger btn-block" onclick="callWaiter()"><span class="glyphicon glyphicon-bell"></span> Chamar Gar√ßon</button>
        </div>

        <div class="main">
            <div id="output" class="clearfix">

                <!--
                    <tr>
                        <td class="text-right" colspan="4" style="vertical-align: middle">
                            <strong>Total <span class="text-success">R$&nbsp;90,00</span></strong>
                        </td>
                    </tr>
                </table>

                -->

            </div>
        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/base.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>

        <script type="text/javascript" src="js/database.js"></script>
        <script type="text/javascript" src="js/functions.js"></script>

        <script type="text/javascript">

                $('#output').css('height', vWindowHeight - 110);
                document.addEventListener("deviceready", onDeviceReady, false);
                function onDeviceReady() {
                    db.transaction(getRecords, errorCallBack, successCallBack);
                }

                function getRecords(tx) {
                    tx.executeSql("SELECT * FROM PedidoProduto WHERE PedidoId = (SELECT Id FROM Pedido WHERE Status = '1' ORDER BY Id DESC LIMIT 1)", [], showRecords, errorCallBack);
                }

                function showRecords(tx, result) {
                    var output = document.getElementById("output");
                    var list = '';
                    list = list + '<div style="margin-top: 20px">';
                    list = list + '<a href = "categorias.html" class = "btn btn-default btn-block"><span class="glyphicon glyphicon-plus"></span> Adicionar item</a>';
                    list = list + '</div>';
                    if (result.rows.length > 0) {

                        list = list + '<table class="table table-bordered" style="width: 100%; margin: 0; margin-top: 20px;">';
                        list = list + '<tr>';
                        list = list + '<th>Item</th>';
                        list = list + '<th style="text-align: center">Qtd.</th>';
                        list = list + '<th style="text-align: center">Valor</th>';
                        list = list + '<th></th>';
                        list = list + '</tr>';

                        for (var i = 0; i < result.rows.length; i++) {
                            list = list + '<tr>';
                            list = list + '<td style="vertical-align: middle">' + result.rows.item(i).ProdutoId + '</td>';
                            list = list + '<td style="text-align: center; vertical-align: middle">' + result.rows.item(i).Quantidade + '</td>';
                            list = list + '<td style="text-align: right; vertical-align: middle">R$&nbsp;' + result.rows.item(i).ValorTotal + '</td>';
                            list = list + '<td style="vertical-align: middle; text-align: center"><a href="#" class="btn btn-danger" onclick="deleteItem(' + result.rows.item(i).PedidoId + ',' + result.rows.item(i).ProdutoId + ')"><span class="glyphicon glyphicon-trash"></span></a></td>';
                            list = list + '</tr>';
                        }
                        list = list + '</table>';
                        list = list + '<div style="margin-top: 20px">';
                        list = list + '<a href="pagamento.html" class="btn btn-success btn-block"><span class="glyphicon glyphicon-chevron-right"></span> Continuar</a>';
                        list = list + '</div>';
                        list = list + '<div style="margin-top: 20px">';
                        list = list + '<a href="#" class="btn btn-danger btn-block" onclick="cancelPedido(?)"><span class="glyphicon glyphicon-ban-circle"></span> Cancelar</a>';
                        list = list + '</div>';
                    } else {
                        list = list + '<div class="alert alert-warning" style="margin-top: 20px; margin-bottom: 0; padding: 5px 10px;">Nenhum registro encontrado.</div>';
                    }
                    output.innerHTML = list;
                }

                function deleteItem(pPedidoId, pProdutoId) {
                    alert('Excluir item...');
                    /*db.transaction(function(transaction) {
                     transaction.executeSql("DELETE FROM Produto WHERE Id = ?", [id], nullCallBack, errorCallBack);
                     }, errorCallBack, pageReload);*/
                }

                function cancelPedido(pPedidoId) {
                    alert('Cancelar pedido...');
                    /*db.transaction(function(transaction) {
                     transaction.executeSql("DELETE FROM Produto WHERE Id = ?", [id], nullCallBack, errorCallBack);
                     }, errorCallBack, pageReload);*/
                }

                function deleteProdutoRecords() {
                    db.transaction(function(transaction) {
                        transaction.executeSql('DELETE FROM Produto', [], nullCallBack, errorCallBack);
                    }, errorCallBack, pageReload);
                }

                function pageReload() {
                    location.href = 'produtos.html';
                }

                function _GET(param) {
                    var url = window.location.search.replace("?", "");
                    var itens = url.split("&");
                    for (n in itens)
                    {
                        if (itens[n].match(param))
                        {
                            return decodeURIComponent(itens[n].replace(param + "=", ""));
                        }
                    }
                    return null;
                }

        </script>

    </body>
</html>
