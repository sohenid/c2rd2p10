<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=yes, initial-scale=1.5, maximum-scale=1.5, minimum-scale=1.5, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>App</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="css/base.css" />
    </head>
    <body>

        <script src="js/ui-menu.js"></script>

        <div class="clearfix" style="padding: 10px 20px; border-bottom: 1px solid #eee">
            <button class="btn btn-default pull-right closed" id="show-hide-menu"><span class="glyphicon glyphicon-align-justify"></span></button>
        </div>

        <div class="main">
            <div id="output" class="clearfix">
                <h1 class="text-success" style="margin: 0; padding: 0; margin-top: 20px; text-align: center">
                    <span class="glyphicon glyphicon-ok"></span>
                </h1>
                <div style="margin-top: 20px; text-align: center">
                    Entregaremos seu pedido dentro de alguns minutos, por favor aguarde.
                </div>
                <div style="margin-top: 20px; text-align: center">
                    Obrigado pela preferÃªncia!
                </div>
            </div>
        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/base.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>

        <script type="text/javascript" src="js/database.js"></script>
        <script type="text/javascript" src="js/functions.js"></script>
        <script type="text/javascript">

            $('#output').css('height', vWindowHeight - 55);

            document.addEventListener("deviceready", onDeviceReady, false);

            function onDeviceReady() {
                db.transaction(getPedidoItens, errorCallBack, successCallBack);
            }

            function getPedidoItens(tx) {
                tx.executeSql("SELECT a.*, (SELECT descricao FROM Produto WHERE Id = a.ProdutoId) as Produto FROM PedidoProduto a WHERE a.PedidoId = (SELECT Id FROM Pedido WHERE Status = '1' ORDER BY Id DESC LIMIT 1)", [], showPedidoItens, errorCallBack);
            }

            function showPedidoItens(tx, result) {
                // 1. Adicionar coluna status na tabela pedidoprodutos
                // 2. Envia uma tupla por vez
                // 3. Cada envio bem sucedido, muda o status da tupla para 0
                // 4. Em caso de falha, mata o processo, e exibe mensagem de erro pedindo pra tantar novamente
                // 5. Somente as tuplas com status 1 devem ser enviadas
                // 6. Exibir mensagem de envio bem sucedido
                for (var i = 0; i < result.rows.length; i++) {
                    alert(result.rows.item(i).ValorTotal);
                }
            }

        </script>

    </body>
</html>
